(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{215:function(e,t,a){e.exports=a(405)},220:function(e,t,a){},241:function(e,t){},243:function(e,t){},390:function(e,t,a){},403:function(e,t,a){},405:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(15),i=a.n(r),s=(a(220),a(59)),l=a(210),d=a(81),c=a(82),u=a(86),p=a(88),v=a(186),h=a(137),m=a.n(h),f=a(187),g=a(410),w=a(48),E=a(92),D=a(411),b=(a(221),a(51)),y=a.n(b),C=a(408),S=function(e){Object(p.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).columns=[{title:"Tag",dataIndex:"name",key:"name"},{title:"Value",dataIndex:"value",key:"value"}],n.state={data:n.props.data},n}return Object(c.a)(a,[{key:"render",value:function(){var e=this.state.data;return o.a.createElement(C.a,{dataSource:e,columns:this.columns})}}]),a}(o.a.Component);a(390);y.a.gui.getElement=y.a.gui.base.getElement,y.a.image.decoderScripts={jpeg2000:"assets/dwv/decoders/pdfjs/decode-jpeg2000.js","jpeg-lossless":"assets/dwv/decoders/rii-mango/decode-jpegloss.js","jpeg-baseline":"assets/dwv/decoders/pdfjs/decode-jpegbaseline.js",rle:"assets/dwv/decoders/dwv/decode-rle.js"};var x=function(e){Object(p.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).initializeDwv=function(){var e=new y.a.App;e.init({containerDivId:"dwv",tools:n.state.tools}),n.addEventListeners(e),n.setState({dwvApp:e}),n.setupDropbox(e),y.a.utils.loadFromUri(window.location.href,e)},n.addEventListeners=function(e){var t=null,a=null;e.addEventListener("load-start",(function(){t=0,a=0})),e.addEventListener("load-progress",(function(e){n.setState({loadProgress:e.loaded})})),e.addEventListener("load",(function(){n.setState({metaData:y.a.utils.objectToArray(e.getMetaData())});var t="Scroll";e.isMonoSliceData()&&1===e.getImage().getNumberOfFrames()&&(t="ZoomAndPan"),n.onChangeTool(t),n.hideDropbox(),n.setState({dataLoaded:!0})})),e.addEventListener("load-end",(function(){t&&(n.setState({loadProgress:0}),alert("Received errors during load. Check log for details.")),a&&(n.setState({loadProgress:0}),alert("Load was aborted.")),n.setState({loadProgress:100},(function(){n.props.handleDicomLoadedState(!0)}))})),e.addEventListener("frame-change",(function(e){n.setState({frame:e.frame})})),e.addEventListener("error",(function(e){console.error(e.error),++t})),e.addEventListener("abort",(function(){++a})),e.addEventListener("keydown",(function(t){e.defaultOnKeydown(t)})),e.addEventListener("draw-move",(function(){n.updateDrawingState()})),e.addEventListener("draw-change",(function(){n.updateDrawingState()})),e.addEventListener("draw-create",(function(e){n.updateDrawingState("add",e.id)})),e.addEventListener("draw-delete",(function(e){n.updateDrawingState("delete",e.id)})),window.addEventListener("resize",e.onResize)},n.updateDrawingState=Object(f.a)(m.a.mark((function e(){var t,a,o,r,i,s,l=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.length>0&&void 0!==l[0]?l[0]:null,a=l.length>1&&void 0!==l[1]?l[1]:null,!(o=n.state.dwvApp)){e.next=14;break}return r=new y.a.State,i=r.toJSON(o),s=JSON.parse(i),e.next=9,n.props.onStateChange;case 9:if(e.t0=e.sent,!e.t0){e.next=12;break}n.props.onStateChange(s);case 12:"add"===t&&n.props.addNewShape&&n.props.addNewShape(a),"delete"===t&&n.props.addNewShape&&n.props.deleteShape(a);case 14:case"end":return e.stop()}}),e)}))),n.getFramesNumberOfDicom=function(){var e=n.state.metaData;if(e){var t=e.find((function(e){return"NumberOfFrames"===e.name})),a=t&&t.value;return a&&parseInt(a)-1}},n.removeDrawings=function(){n.state.dwvApp.deleteDraws(),n.props.handleReset&&n.props.handleReset(!1)},n.onChangeTool=function(e){var t=n.state,a=t.dwvApp,o=t.tools.Draw.options;a&&(n.setState({selectedTool:e}),a.setTool(e),"Draw"===e&&n.onChangeShape(o[0]))},n.onChangeShape=function(e){var t=n.state.dwvApp;t&&t.setDrawShape(e)},n.handleTagsDialogOpen=function(){n.setState({showDicomTags:!0})},n.handleTagsDialogClose=function(){n.setState({showDicomTags:!1})},n.setupDropbox=function(e){var t=e.getElement("layerContainer");t&&(t.addEventListener("dragover",n.onDragOver),t.addEventListener("dragleave",n.onDragLeave),t.addEventListener("drop",n.onDrop));var a=e.getElement(n.state.dropboxClassName);if(a){var o=2*e.getLayerContainerSize().height/3;a.setAttribute("style","width:"+o+"px;height:"+o+"px")}},n.onDragOver=function(e){var t=n.state,a=t.dwvApp,o=t.borderClassName,r=t.hoverClassName;e.stopPropagation(),e.preventDefault();var i=a.getElement(o);i&&-1===i.className.indexOf(r)&&(i.className+=" "+r)},n.onDragLeave=function(e){var t=n.state,a=t.dwvApp,o=t.hoverClassName;e.stopPropagation(),e.preventDefault();var r=a.getElement(n.borderClassName+" hover");r&&-1!==r.className.indexOf(o)&&(r.className=r.className.replace(" "+o,""))},n.hideDropbox=function(){var e=n.state,t=e.dwvApp,a=e.dropboxClassName,o=t.getElement(a);o&&o.parentNode.removeChild(o)},n.onDrop=function(e){var t=n.state.dwvApp;e.stopPropagation(),e.preventDefault(),t.loadFiles(e.dataTransfer.files),n.hideDropbox()},n.drawCircle=function(){var e=n.state,t=e.dwvApp,a=e.loadProgress,o=e.dataLoaded,r=n.props.circle,i=r.center,s=i.x,l=i.y,d=r.r;if(t&&o&&100===a){var c=new y.a.math.Point2D(s,l),u=new y.a.math.Point2D(s+d,l+d),p=new y.a.tool.draw.EllipseFactory.prototype.create([c,u],t.getStyle(),t.getImage()),v=t.getDrawController().getDrawLayer();v.add(p),v.draw()}},n.onCanvasClick=function(e){var t=n.state.dwvApp,a=t.getImageLayer(),o=t.getImageData(),r=o.width,i=o.height,s=a.getCanvas(),l=r/s.width,d=i/s.height,c=(e.clientX-e.target.getBoundingClientRect().left)*l,u=(e.clientY-e.target.getBoundingClientRect().top)*d;n.props.addPoint&&n.props.addPoint(c,u)},n.state={tools:{Draw:{options:["Ellipse"],type:"factory",events:["draw-create","draw-change","draw-move","draw-delete"]},ZoomAndPan:{}},selectedTool:"Select Tool",loadProgress:0,dataLoaded:!1,dwvApp:null,metaData:[],showDicomTags:!1,dropboxClassName:"dropBox",borderClassName:"dropBoxBorder",hoverClassName:"hover",frame:0},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.initializeDwv()}},{key:"componentDidUpdate",value:function(e){if(this.props.dicom!==e.dicom&&null!==this.props.dicom){var t=[this.props.dicom];this.state.dwvApp.loadFiles(t)}this.props.selectedTool!==e.selectedTool&&this.onChangeTool(this.props.selectedTool),this.props.draw&&this.drawCircle(),this.props.reset&&(console.log("xd"),this.removeDrawings())}},{key:"render",value:function(){var e=this,t=this.state,a=t.loadProgress,n=t.dataLoaded,r=t.metaData,i=t.selectedTool,s=t.showDicomTags;return o.a.createElement("div",{id:"dwv"},o.a.createElement(g.a,{percent:a}),o.a.createElement(w.a,{onClick:this.handleTagsDialogOpen,disabled:!n},"Tagi DICOM"),"Draw"===i&&o.a.createElement(E.a,null,"Dodawanie / Edycja artefaktu..."),o.a.createElement(D.a,{visible:s,onCancel:this.handleTagsDialogClose,width:1e3,footer:null},o.a.createElement(S,{data:r})),o.a.createElement("div",{className:"layerContainer"},o.a.createElement("div",{className:"dropBox dropBoxBorder"},"Przeci\u0105gnij i upu\u015b\u0107 tutaj"),o.a.createElement("canvas",Object(v.a)({className:"imageLayer",onClick:this.calculateClickPosition},"onClick",(function(t){return e.onCanvasClick(t)})),"Only for HTML5 compatible browsers..."),o.a.createElement("div",{className:"drawDiv"})),this.getFramesNumberOfDicom()&&"Frame: ".concat(this.state.frame," / ").concat(this.getFramesNumberOfDicom()))}}]),a}(o.a.Component),j=function(e){return o.a.createElement("div",null)},O=a(52),L=a(56);function k(){var e=Object(s.a)(["\n\n"]);return k=function(){return e},e}var P=L.a.div(k()),N=function(e){return o.a.createElement(P,null,o.a.createElement(E.a,{gutter:[16,16]},o.a.createElement(O.a,{span:12},3===e.points.length?o.a.createElement(w.a,{onClick:function(){return e.handleReset(!0)}},"Resetuj"):o.a.createElement(w.a,{onClick:function(){return e.handlePointsButton(!0)}}," Wyznacz punkty")),o.a.createElement(O.a,{span:12},e.points.length," / 3")),o.a.createElement(E.a,{gutter:[16,16]},o.a.createElement(O.a,{span:12}),o.a.createElement(O.a,{span:12})))},T=a(409);function A(){var e=Object(s.a)(["\n    width: 100%;\n    height: 100%;\n\n    .ant-card-head {\n        border-bottom: 0px;\n    }\n\n    .ant-card-body {\n        padding-top: 0px;\n    }\n\n    .ant-card-head-title {\n        color: #55595d;\n    }\n"]);return A=function(){return e},e}var M=Object(L.a)(T.a)(A()),B=function(e){return o.a.createElement(M,{title:null===e||void 0===e?void 0:e.title,bordered:null===e||void 0===e?void 0:e.bordered},null===e||void 0===e?void 0:e.children)},F=a(100),R=a(412);function I(){var e=Object(s.a)(["\n    display: flex;\n    flex-direction: row;\n"]);return I=function(){return e},e}function z(){var e=Object(s.a)(["\n    width: 100%;\n"]);return z=function(){return e},e}var J=F.a.Option,K=Object(L.a)(F.a)(z()),W=L.a.div(I()),U=function(e){return o.a.createElement(W,null,o.a.createElement(K,{value:null===e||void 0===e?void 0:e.selectedOption,onChange:function(t){return e.onChange(t)},disabled:null===e||void 0===e?void 0:e.disabled,placeholder:null===e||void 0===e?void 0:e.placeholder},e.options&&e.options.map((function(e){return o.a.createElement(J,{key:e.value,value:e.value},e.label)}))),o.a.createElement(w.a,{icon:o.a.createElement(R.a,null),onClick:function(){D.a.info({title:null===e||void 0===e?void 0:e.title,content:null===e||void 0===e?void 0:e.infoContent,onOk:function(){}})}}))};function Z(){var e=Object(s.a)(["\n    padding: 50px;\n"]);return Z=function(){return e},e}var q=function(e){Object(p.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).handleDicomLoadedState=function(e){n.setState({isDicomLoaded:e})},n.handleDraw=function(e){n.setState({draw:e})},n.handleReset=function(e){e&&n.setState({points:[]}),n.setState({reset:e})},n.handlePointsButton=function(e){n.setState({canChoosePoints:e})},n.action=function(){var e=n.state,t=e.option,a=e.points,r=e.circle;switch(t){case 1:return o.a.createElement(N,{handlePointsButton:n.handlePointsButton,points:a,circle:r,handleReset:n.handleReset});case 2:return o.a.createElement(j,{handlePointsButton:n.handlePointsButton,points:a,circle:r});default:return o.a.createElement(o.a.Fragment,null)}},n.handleAddPoint=function(e,t){var a=n.state,o=a.points,r=a.canChoosePoints;if(o.length<3&&r){var i={x:e,y:t};n.setState({points:[].concat(Object(l.a)(o),[i])},(function(){if(3===n.state.points.length){var e=function(e,t,a){var n=e.x-t.x,o=e.x-a.x,r=e.y-t.y,i=e.y-a.y,s=a.y-e.y,l=t.y-e.y,d=a.x-e.x,c=t.x-e.x,u=Math.pow(e.x,2)-Math.pow(a.x,2),p=Math.pow(e.y,2)-Math.pow(a.y,2),v=Math.pow(t.x,2)-Math.pow(e.x,2),h=Math.pow(t.y,2)-Math.pow(e.y,2),m=(u*n+p*n+v*o+h*o)/(2*(s*n-l*o)),f=(u*r+p*r+v*i+h*i)/(2*(d*r-c*i)),g=-1*f,w=-1*m,E=g*g+w*w-(-Math.pow(e.x,2)-Math.pow(e.y,2)-2*f*e.x-2*m*e.y);return{center:{x:g+0,y:w+0},r:Math.sqrt(E)}}(n.state.points[0],n.state.points[1],n.state.points[2]);n.setState({draw:!0,circle:e,canChoosePoints:!1},(function(){return n.handleDraw(!1)}))}}))}},n.options=[{label:"Ko\u0142o na podstawie trzech punkt\xf3w",value:1},{label:"Ko\u0142o \u015brodek, promie\u0144",value:2}],n.state={isDicomLoaded:!1,option:0,draw:!1,points:[],circle:{center:{x:0,y:0},r:0},canChoosePoints:!1,reset:!1},n}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=this.state,a=t.isDicomLoaded,n=t.draw,r=t.circle,i=t.reset;return o.a.createElement(H,null,o.a.createElement(E.a,{gutter:[16,16]},o.a.createElement(O.a,{span:6},o.a.createElement(B,{title:"Konfiguruj"},o.a.createElement(o.a.Fragment,null,o.a.createElement(E.a,{gutter:[16,16]},o.a.createElement(O.a,{span:24},o.a.createElement(U,{options:this.options,onChange:function(t){return e.setState({option:t})},placeholder:"Wybierz opcj\u0119",disabled:!a,title:"Uwaga!",infoContent:o.a.createElement(o.a.Fragment,null,"Aby m\xf3\u0107 wybra\u0107 opcj\u0119 wgraj plik DIcom")}))),this.action()))),o.a.createElement(O.a,{span:12},o.a.createElement(x,{handleDicomLoadedState:this.handleDicomLoadedState,handleReset:this.handleReset,draw:n,reset:i,handleDraw:this.handleDraw,addPoint:this.handleAddPoint,circle:r})),o.a.createElement(O.a,{span:6})))}}]),a}(n.Component),H=L.a.div(Z()),V=q;a(403),a(404);var X=function(){return o.a.createElement("div",{className:"App"},o.a.createElement(V,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(X,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[215,1,2]]]);
//# sourceMappingURL=main.624dc196.chunk.js.map