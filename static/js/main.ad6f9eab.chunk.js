(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{229:function(e,t,a){e.exports=a(431)},234:function(e,t,a){},254:function(e,t){},256:function(e,t){},401:function(e,t,a){},429:function(e,t,a){},431:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(16),i=a.n(r),l=(a(234),a(46)),s=a(145),c=a(85),d=a(86),u=a(91),p=a(93),h=a(197),m=a(141),v=a.n(m),g=a(198),f=a(436),w=a(47),E=a(96),x=a(437),b=a(138),D=a.n(b),S=a(56),C=a.n(S),y=a(434),O=function(e){Object(p.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).columns=[{title:"Tag",dataIndex:"name",key:"name"},{title:"Value",dataIndex:"value",key:"value"}],n.state={data:n.props.data},n}return Object(d.a)(a,[{key:"render",value:function(){var e=this.state.data;return o.a.createElement(y.a,{dataSource:e,columns:this.columns})}}]),a}(o.a.Component);a(401);C.a.gui.getElement=C.a.gui.base.getElement,C.a.image.decoderScripts={jpeg2000:"assets/dwv/decoders/pdfjs/decode-jpeg2000.js","jpeg-lossless":"assets/dwv/decoders/rii-mango/decode-jpegloss.js","jpeg-baseline":"assets/dwv/decoders/pdfjs/decode-jpegbaseline.js",rle:"assets/dwv/decoders/dwv/decode-rle.js"};var j=function(e){Object(p.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).initializeDwv=function(){var e=new C.a.App;e.init({containerDivId:"dwv",tools:n.state.tools}),n.addEventListeners(e),n.setState({dwvApp:e}),n.setupDropbox(e),C.a.utils.loadFromUri(window.location.href,e)},n.addEventListeners=function(e){var t=null,a=null;e.addEventListener("load-start",(function(){t=0,a=0})),e.addEventListener("load-progress",(function(e){n.setState({loadProgress:e.loaded})})),e.addEventListener("load",(function(){n.setState({metaData:C.a.utils.objectToArray(e.getMetaData())});var t="Scroll";e.isMonoSliceData()&&1===e.getImage().getNumberOfFrames()&&(t="ZoomAndPan"),n.onChangeTool(t),n.hideDropbox(),n.setState({dataLoaded:!0})})),e.addEventListener("load-end",(function(){t&&(n.setState({loadProgress:0}),alert("Received errors during load. Check log for details.")),a&&(n.setState({loadProgress:0}),alert("Load was aborted.")),n.setState({loadProgress:100},(function(){n.props.handleDicomLoadedState(!0)}))})),e.addEventListener("frame-change",(function(e){n.setState({frame:e.frame})})),e.addEventListener("error",(function(e){console.error(e.error),++t})),e.addEventListener("abort",(function(){++a})),e.addEventListener("keydown",(function(t){e.defaultOnKeydown(t)})),e.addEventListener("draw-move",(function(){n.updateDrawingState()})),e.addEventListener("draw-change",(function(){n.updateDrawingState()})),e.addEventListener("draw-create",(function(e){n.updateDrawingState("add",e.id)})),e.addEventListener("draw-delete",(function(e){n.updateDrawingState("delete",e.id)})),window.addEventListener("resize",e.onResize)},n.updateDrawingState=Object(g.a)(v.a.mark((function e(){var t,a,o,r,i,l,s=arguments;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:null,a=s.length>1&&void 0!==s[1]?s[1]:null,!(o=n.state.dwvApp)){e.next=14;break}return r=new C.a.State,i=r.toJSON(o),l=JSON.parse(i),e.next=9,n.props.onStateChange;case 9:if(e.t0=e.sent,!e.t0){e.next=12;break}n.props.onStateChange(l);case 12:"add"===t&&n.props.addNewShape&&n.props.addNewShape(a),"delete"===t&&n.props.addNewShape&&n.props.deleteShape(a);case 14:case"end":return e.stop()}}),e)}))),n.getFramesNumberOfDicom=function(){var e=n.state.metaData;if(e){var t=e.find((function(e){return"NumberOfFrames"===e.name})),a=t&&t.value;return a&&parseInt(a)-1}},n.removeDrawings=function(){n.state.dwvApp.deleteDraws(),n.props.handleReset&&n.props.handleReset(!1)},n.onChangeTool=function(e){var t=n.state,a=t.dwvApp,o=t.tools.Draw.options;a&&(n.setState({selectedTool:e}),a.setTool(e),"Draw"===e&&n.onChangeShape(o[0]))},n.onChangeShape=function(e){var t=n.state.dwvApp;t&&t.setDrawShape(e)},n.handleTagsDialogOpen=function(){n.setState({showDicomTags:!0})},n.handleTagsDialogClose=function(){n.setState({showDicomTags:!1})},n.setupDropbox=function(e){var t=e.getElement("layerContainer");t&&(t.addEventListener("dragover",n.onDragOver),t.addEventListener("dragleave",n.onDragLeave),t.addEventListener("drop",n.onDrop));var a=e.getElement(n.state.dropboxClassName);if(a){var o=2*e.getLayerContainerSize().height/3;a.setAttribute("style","width:"+o+"px;height:"+o+"px")}},n.onDragOver=function(e){var t=n.state,a=t.dwvApp,o=t.borderClassName,r=t.hoverClassName;e.stopPropagation(),e.preventDefault();var i=a.getElement(o);i&&-1===i.className.indexOf(r)&&(i.className+=" "+r)},n.onDragLeave=function(e){var t=n.state,a=t.dwvApp,o=t.hoverClassName;e.stopPropagation(),e.preventDefault();var r=a.getElement(n.borderClassName+" hover");r&&-1!==r.className.indexOf(o)&&(r.className=r.className.replace(" "+o,""))},n.hideDropbox=function(){var e=n.state,t=e.dwvApp,a=e.dropboxClassName,o=t.getElement(a);o&&o.parentNode.removeChild(o)},n.onDrop=function(e){var t=n.state.dwvApp;e.stopPropagation(),e.preventDefault(),t.loadFiles(e.dataTransfer.files),n.hideDropbox()},n.drawCircle=function(){var e=n.state,t=e.dwvApp,a=e.loadProgress,o=e.dataLoaded,r=n.props.circle,i=r.center,l=i.x,s=i.y,c=r.r;if(t&&o&&100===a){var d=new C.a.math.Point2D(l,s),u=new C.a.math.Point2D(l+c,s+c),p=new C.a.tool.draw.EllipseFactory.prototype.create([d,u],t.getStyle(),t.getImage()),h=t.getDrawController().getDrawLayer();h.add(p),h.draw()}},n.updatePropsParams=function(){n.state.metaData.forEach((function(e){"0x0018"===e.group&&e.element,"0x0018"===e.group&&e.element,"0x0028"===e.group&&"0x0030"===e.element&&n.props.handlePixelSpacing&&n.props.handlePixelSpacing(e.value)}))},n.onCanvasClick=function(e){var t=n.state.dwvApp,a=t.getImageLayer(),o=t.getImageData(),r=o.width,i=o.height,l=a.getCanvas(),s=r/l.width,c=i/l.height,d=(e.clientX-e.target.getBoundingClientRect().left)*s,u=(e.clientY-e.target.getBoundingClientRect().top)*c;n.props.addPoint&&n.props.addPoint(d,u)},n.state={tools:{Draw:{options:["Ellipse"],type:"factory",events:["draw-create","draw-change","draw-move","draw-delete"]},ZoomAndPan:{}},selectedTool:"Select Tool",loadProgress:0,dataLoaded:!1,dwvApp:null,metaData:[],showDicomTags:!1,dropboxClassName:"dropBox",borderClassName:"dropBoxBorder",hoverClassName:"hover",frame:0},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.initializeDwv()}},{key:"componentDidUpdate",value:function(e){if(this.props.dicom!==e.dicom&&null!==this.props.dicom){var t=[this.props.dicom];this.state.dwvApp.loadFiles(t)}this.props.selectedTool!==e.selectedTool&&this.onChangeTool(this.props.selectedTool),this.props.hasPixelSpacing||this.updatePropsParams(),this.props.draw&&this.drawCircle(),this.props.reset&&(console.log("xd"),this.removeDrawings())}},{key:"render",value:function(){var e=this,t=this.state,a=t.loadProgress,n=t.dataLoaded,r=t.metaData,i=t.selectedTool,l=t.showDicomTags;return o.a.createElement("div",{id:"dwv"},o.a.createElement(f.a,{percent:a}),o.a.createElement(w.a,{onClick:this.handleTagsDialogOpen,disabled:!n},"Tagi DICOM"),"Draw"===i&&o.a.createElement(E.a,null,"Dodawanie / Edycja artefaktu..."),o.a.createElement(x.a,{visible:l,onCancel:this.handleTagsDialogClose,width:1e3,footer:null},o.a.createElement(O,{data:r})),o.a.createElement("div",{className:"layerContainer"},o.a.createElement("div",{className:"dropBox dropBoxBorder"},"Przeci\u0105gnij i upu\u015b\u0107 tutaj"),o.a.createElement("canvas",Object(h.a)({className:"imageLayer",onClick:this.calculateClickPosition},"onClick",(function(t){return e.onCanvasClick(t)})),"Only for HTML5 compatible browsers..."),o.a.createElement("div",{className:"drawDiv"})),this.getFramesNumberOfDicom()&&"Frame: ".concat(this.state.frame," / ").concat(this.getFramesNumberOfDicom()))}}]),a}(o.a.Component),P=a(104),k=a(57),L=a(438),N=function(e,t){if(t&&e>0){var a=t&&t.split("\\")[0];return e*parseFloat(a)/10}return e},T=a(44);function R(){var e=Object(l.a)(["\n    width: 100%;\n"]);return R=function(){return e},e}function A(){var e=Object(l.a)(["\n    width: 100% !important;\n"]);return A=function(){return e},e}function F(){var e=Object(l.a)(["\n    width: 60%;\n"]);return F=function(){return e},e}function B(){var e=Object(l.a)(["\n    display: flex !important;\n    flex-direction: row;\n"]);return B=function(){return e},e}var M=P.a.Option,z=Object(T.a)(L.a.Group)(B()),I=Object(T.a)(P.a)(F()),W=Object(T.a)(L.a)(A()),J=Object(T.a)(w.a)(R()),K=function(e){var t=function(t){var a=e.radius,n=0;"px"===t?n=function(e,t){if(t&&e>0){var a=t&&t.split("\\")[0];return 10*e/parseFloat(a)}return e}(a,e.pixelSpacing):"cm"==t&&(n=N(a,e.pixelSpacing)),e.handleRadiusChange(n)};return o.a.createElement("div",null,o.a.createElement(E.a,{gutter:[16,16]},o.a.createElement(k.a,{span:24},o.a.createElement(z,{compact:!0},o.a.createElement(W,{style:{width:"50%"},defaultValue:"0",value:e.radius,onChange:function(t){return function(t){var a=parseFloat(t);D.a.isNumber(a)&&a>0?e.handleRadiusChange(a):e.handleRadiusChange(0)}(t.target.value)}}),o.a.createElement(I,{defaultValue:"cm",onChange:function(e){return t(e)}},o.a.createElement(M,{value:"cm"},"cm"),o.a.createElement(M,{value:"px"},"px"))))),o.a.createElement(E.a,{gutter:[16,16]},o.a.createElement(k.a,{span:12},1===e.points.length?o.a.createElement(J,{onClick:function(){return e.handleReset(!0)}},"Resetuj"):o.a.createElement(J,{onClick:function(){return e.handlePointsButton(!0)}}," Wyznacz \u015brodek")),o.a.createElement(k.a,{span:12},e.points.length," / 1")))},U=a(440);function V(){var e=Object(l.a)(["\n    width: 100%;\n"]);return V=function(){return e},e}function Z(){var e=Object(l.a)(["\n\n"]);return Z=function(){return e},e}var q=T.a.div(Z()),G=Object(T.a)(w.a)(V()),H=function(e){var t=e.circle,a=t.center,n=t.r;return o.a.createElement(q,null,o.a.createElement(E.a,{gutter:[16,16]},o.a.createElement(k.a,{span:12},3===e.points.length?o.a.createElement(G,{onClick:function(){return e.handleReset(!0)}},"Resetuj"):o.a.createElement(G,{onClick:function(){return e.handlePointsButton(!0)}}," Wyznacz punkty")),o.a.createElement(k.a,{span:12},e.points.length," / 3")),3===e.points.length&&o.a.createElement(o.a.Fragment,null,o.a.createElement(E.a,{gutter:[16,16]},o.a.createElement(k.a,{span:24},o.a.createElement(U.a,{title:"\u015arodek",value:"[ ".concat(a.x.toFixed(3),", ").concat(a.y.toFixed(3)," ]")}))),o.a.createElement(E.a,{gutter:[16,16]},o.a.createElement(k.a,{span:24},o.a.createElement(U.a,{title:"Promie\u0144",suffix:"px",value:n.toFixed(3)}))),o.a.createElement(E.a,{gutter:[16,16]},o.a.createElement(k.a,{span:24},o.a.createElement(U.a,{title:"Promie\u0144",suffix:"cm",value:N(n,e.pixelSpacing).toFixed(3)})))))},X=a(435);function Y(){var e=Object(l.a)(["\n    width: 100%;\n    height: 100%;\n\n    .ant-card-head {\n        border-bottom: 0px;\n    }\n\n    .ant-card-body {\n        padding-top: 0px;\n    }\n\n    .ant-card-head-title {\n        color: #55595d;\n    }\n"]);return Y=function(){return e},e}var $=Object(T.a)(X.a)(Y()),Q=function(e){return o.a.createElement($,{title:null===e||void 0===e?void 0:e.title,bordered:null===e||void 0===e?void 0:e.bordered},null===e||void 0===e?void 0:e.children)},_=a(439);function ee(){var e=Object(l.a)(["\n    display: flex;\n    flex-direction: row;\n"]);return ee=function(){return e},e}function te(){var e=Object(l.a)(["\n    width: 100%;\n"]);return te=function(){return e},e}var ae=P.a.Option,ne=Object(T.a)(P.a)(te()),oe=T.a.div(ee()),re=function(e){return o.a.createElement(oe,null,o.a.createElement(ne,{value:null===e||void 0===e?void 0:e.selectedOption,onChange:function(t){return e.onChange(t)},disabled:null===e||void 0===e?void 0:e.disabled,placeholder:null===e||void 0===e?void 0:e.placeholder},e.options&&e.options.map((function(e){return o.a.createElement(ae,{key:e.value,value:e.value},e.label)}))),o.a.createElement(w.a,{icon:o.a.createElement(_.a,null),onClick:function(){x.a.info({title:null===e||void 0===e?void 0:e.title,content:null===e||void 0===e?void 0:e.infoContent,onOk:function(){}})}}))};function ie(){var e=Object(l.a)(["\n    padding: 50px;\n"]);return ie=function(){return e},e}var le=function(e){Object(p.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleDicomLoadedState=function(e){n.setState({isDicomLoaded:e})},n.handlePixelSpacing=function(e){n.setState({pixelSpacing:e})},n.handleDraw=function(e){n.setState({draw:e})},n.handleOptionChange=function(e){1===e?n.setState({menuOption:"3point"}):2==e&&n.setState({menuOption:"1pointcenter"}),n.setState({option:e})},n.handleRadiusChange=function(e){n.setState({radius:e})},n.handleReset=function(e){e&&n.setState({points:[],radius:0}),n.setState({reset:e})},n.handlePointsButton=function(e){n.setState({canChoosePoints:e})},n.action=function(){var e=n.state,t=e.option,a=e.points,r=e.circle,i=e.pixelSpacing,l=e.radius;switch(t){case 1:return o.a.createElement(H,{handlePointsButton:n.handlePointsButton,points:a,circle:r,handleReset:n.handleReset,pixelSpacing:i});case 2:return o.a.createElement(K,{handlePointsButton:n.handlePointsButton,points:a,circle:r,handleReset:n.handleReset,handleRadiusChange:n.handleRadiusChange,pixelSpacing:i,radius:l});default:return o.a.createElement(o.a.Fragment,null)}},n.handleAddPoint=function(e,t){var a=n.state,o=a.points,r=a.canChoosePoints,i=a.menuOption,l={x:e,y:t};switch(i){case"3point":o.length<3&&r&&n.setState({points:[].concat(Object(s.a)(o),[l])},(function(){if(3===n.state.points.length){var e=function(e,t,a){var n=e.x-t.x,o=e.x-a.x,r=e.y-t.y,i=e.y-a.y,l=a.y-e.y,s=t.y-e.y,c=a.x-e.x,d=t.x-e.x,u=Math.pow(e.x,2)-Math.pow(a.x,2),p=Math.pow(e.y,2)-Math.pow(a.y,2),h=Math.pow(t.x,2)-Math.pow(e.x,2),m=Math.pow(t.y,2)-Math.pow(e.y,2),v=(u*n+p*n+h*o+m*o)/(2*(l*n-s*o)),g=(u*r+p*r+h*i+m*i)/(2*(c*r-d*i)),f=-1*g,w=-1*v,E=f*f+w*w-(-Math.pow(e.x,2)-Math.pow(e.y,2)-2*g*e.x-2*v*e.y);return{center:{x:f+0,y:w+0},r:Math.sqrt(E)}}(n.state.points[0],n.state.points[1],n.state.points[2]);n.setState({draw:!0,circle:e,canChoosePoints:!1},(function(){return n.handleDraw(!1)}))}}));break;case"1pointcenter":if(o.length<1&&r){var c=n.state.radius;n.setState({points:[].concat(Object(s.a)(o),[l])},(function(){if(1===n.state.points.length){var e={center:{x:l.x,y:l.y},r:c};console.log(e),n.setState({draw:!0,circle:e,canChoosePoints:!1},(function(){return n.handleDraw(!1)}))}}))}}},n.options=[{label:"Ko\u0142o na podstawie trzech punkt\xf3w",value:1},{label:"Ko\u0142o \u015brodek, promie\u0144",value:2}],n.state={isDicomLoaded:!1,option:0,draw:!1,points:[],circle:{center:{x:0,y:0},r:0},canChoosePoints:!1,reset:!1,pixelSpacing:"0",menuOption:null,radius:0},n}return Object(d.a)(a,[{key:"render",value:function(){var e=this,t=this.state,a=t.isDicomLoaded,n=t.draw,r=t.circle,i=t.reset,l=t.pixelSpacing;return o.a.createElement(se,null,o.a.createElement(E.a,{gutter:[16,16]},o.a.createElement(k.a,{span:6},o.a.createElement(Q,{title:"Konfiguruj"},o.a.createElement(o.a.Fragment,null,o.a.createElement(E.a,{gutter:[16,16]},o.a.createElement(k.a,{span:24},o.a.createElement(re,{options:this.options,onChange:function(t){return e.handleOptionChange(t)},placeholder:"Wybierz opcj\u0119",disabled:!a,title:"Uwaga!",infoContent:o.a.createElement(o.a.Fragment,null,"Aby m\xf3\u0107 wybra\u0107 opcj\u0119 wgraj plik DIcom")}))),this.action()))),o.a.createElement(k.a,{span:12},o.a.createElement(j,{handleDicomLoadedState:this.handleDicomLoadedState,handleReset:this.handleReset,handlePixelSpacing:this.handlePixelSpacing,draw:n,reset:i,handleDraw:this.handleDraw,addPoint:this.handleAddPoint,circle:r,hasPixelSpacing:Boolean(parseFloat(l))})),o.a.createElement(k.a,{span:6})))}}]),a}(n.Component),se=T.a.div(ie()),ce=le;a(429),a(430);var de=function(){return o.a.createElement("div",{className:"App"},o.a.createElement(ce,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(de,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[229,1,2]]]);
//# sourceMappingURL=main.ad6f9eab.chunk.js.map